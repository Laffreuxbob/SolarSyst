<!--
Start ne réinitialise pas, et laisse les anciennes planetes

Style line et style traj s'appliquent sur 1 Astres // L'écran en général, deux accès a style traj
=> input radio 'aucun'

Equilibrer les coeff (G, f, m/r..)

-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Solar</title>
    <link rel="stylesheet" href="solarStyle.css">
</head>

<body>

<div id="all">
    <div id="title">
        <label for="nb" id="nbAstres">Nombre d'Astres :
            <input type="number" name="nb" id="nb" min="1" max="10">
        </label>
        <br>
        <div id="colorForm">Couleur :<br>

            <label for="colorNone">
                <input class="line" id="colorNone" type="radio" name="Color" value="Aucune" checked>Aucun
            </label>

            <label for="colorPosition">
                <input class="line" id="colorPosition" type="radio" name="Color" value="Position">Position
            </label>

            <label for="colorVitesse">
                <input class="line" id="colorVitesse" type="radio" name="Color" value="Vitesse">Vitesse
            </label>

            <div id="colorType">Aucune couleur</div>

        </div>
        <div id="styleForm">Style :<br>

            <label for="styleNone">
                <input class="line" id="styleNone" type="radio" name="Style" checked>Aucun
            </label>

            <label for="styleLine">
                <input class="line" id="styleLine" type="radio" name="Style">Ligne
            </label>

            <label for="styleTrajectoire">
                <input class="line" id="styleTrajectoire" type="radio" name="Style">Trajectoire
            </label>

            <div id="styleType">Aucun style</div>

        </div>
        <input type="submit" id="start" value="Start" onclick="start()">
        <button onclick="stop()">stop</button>
    </div>

    <div id="mainContent">
        <div id="graph">
            <canvas id="myCanvasGraph" style="background: url(space.jpg)  0 0 ; "></canvas>
        </div>
        <div id="stats">
            <canvas id="myCanvasStats" style="background: #d8d8d8 "></canvas>
        </div>
    </div>
</div>

</body>

<script>
    // Element canva de base
    let c1;
    c1 = document.getElementById("myCanvasGraph");
    let ctx1 = c1.getContext("2d");
    // Constantes pour l'init des coordonnées
    let H = c1.height;
    let W = c1.width;
    // Auto play
    let auto;

    //Fonction mère
    function start() {
        auto = true;
        clear();
        let liste;
        let nb = document.getElementById("nb").value;
        if (nb <= 0) {
            nb = 2;
        }
        liste = new ListeAstres(nb);
        liste.init();
        play(liste, auto);
    }

    function stop() {
        auto = false;
        clear();
    }

    function setInfos() {
        if(document.getElementById('colorPosition').checked){document.getElementById('colorStyle').innerHTML = document.getElementById('colorPosition').value}
    }

    function play(listeP, auto) {
        setInfos();
        if (auto) {
            clear();
            setInterval(function () {
                listeP.moveL();
                if (!document.getElementById("styleTrajectoire").checked) {
                    clear();
                }
                listeP.drawL();
            }, 30);
        }
    }

    //Clear ctx
    function clear() {
        ctx1.clearRect(0, 0, W, H);
    }

    class Astre {
        constructor(sun, x, y, vx, vy, r, color) {
            this.sun = sun;
            this.x = x;
            this.y = y;

            this.vx = vx;
            this.vy = vy;

            this.r = r;
            this.color = color;
        }

        draw(doc) { // Beginpath et stroke sont dans drawL
            if (document.getElementById('styleLine').checked) {
                doc.strokeStyle = 'grey';
                doc.moveTo(W / 2, H / 2);
                doc.lineTo(this.x, this.y);
                doc.stroke();
            }
            this.setColor();
            doc.beginPath();
            doc.arc(this.x, this.y, this.r / 10, 0, 2 * Math.PI);
            doc.fillStyle = this.color;
            doc.fill();
        }

        setColor() {
            if (this.sun) {
                this.color = "yellow"
            } else {
                this.color = "blue"
            }
        }

        force(sun) {
            let G = 600;  // Constante gravitationnelle 6.67 E-11  m3 kg-1 s-2
            let dist = Math.sqrt((sun.x - this.x) ** 2 + (sun.y - this.y) ** 2);
            let coef = (G * this.r / 10 * sun.r / 10) / (dist ** 3);  // (G * mA * mB) / d3
            return [coef * (sun.x - this.x), coef * (sun.y - this.y)];
        }

        move(sun) {
            if (!this.sun) {
                let dt = 0.1;

                let force = this.force(sun);

                let ax = force[0];
                let ay = force[1];

                this.x = this.x + this.vx * dt + ax * dt * dt * (1 / 2);
                this.y = this.y + this.vy * dt + ay * dt * dt * (1 / 2);

                this.x = cadre(this.x, W);
                this.y = cadre(this.y, H);

                this.vx = this.vx + ax * dt;
                this.vy = this.vy + ay * dt;
            }
        }
    }

    class ListeAstres {
        constructor(len) {
            this.len = len;
            this.listeInit = [];
        }

        init() {
            let dist = H / (2 * this.len);
            this.listeInit[0] = new Astre(true, W / 2, H / 2, 0, 0, 100, "yellow");
            for (let i = 1; i < this.len; i++) {
                let v = (20 - i) * (-1) ** i;
                this.listeInit.push(new Astre(false, W / 2, H / 2 + i * dist, v, v, 40, 'blue'));
            }
        }

        moveL() {
            let listeV = [];
            let sun = this.listeInit[0];
            for (let i = 0; i < this.listeInit.length; i++) {
                this.listeInit[i].move(sun);
            }
        }

        drawL() {
            if(!document.getElementById("styleTrajectoire").checked){
                clear();
            }
            for (let p = 0; p < this.listeInit.length; p++) {
                let planete = this.listeInit[p];
                planete.setColor();
                ctx1.beginPath();
                planete.draw(ctx1);
                ctx1.stroke();
            }
        }
    }

    function cadre(t, Max) {
        if (t > Max) {
            t = 0;
        } else if (t < 0) {
            t = Max;
        }
        return t;
    }

    let c2;
    c2 = document.getElementById("myCanvasStats");
    let ctx2 = c2.getContext("2d");

    ctx2.beginPath();
    console.log("test");

    ctx2.arc(5,5,5,0,2*Math.PI);

    ctx2.fillStyle = "green";
    ctx2.fill();
    ctx2.stroke();

</script>
</html>